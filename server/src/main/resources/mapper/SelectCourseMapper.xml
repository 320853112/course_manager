<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.denghuo.course_manage.dao.SelectCourseDAO">
    <insert id="pickCourse">
        insert into sc (stu_id,course_id) values(#{stuId},#{courseId})
    </insert>

    <update id="reduceCourse" parameterType="String">
        update course set surplus = surplus - 1 where id = #{course_id}
    </update>

    <select id="getCourseByCondition" parameterType="map" resultType="CourseScoreVO">
        SELECT c.id, c.name ,sc.score,c.category,c.start_time,c.end_time,c.credit,c.check_type,c.study_type
         FROM sc,course as c where stu_id = #{courseScoreDTO.id} and sc.course_id = c.id
        <if test="courseScoreDTO.startTime!=null">
           and c.start_time>#{courseScoreDTO.startTime}
        </if>
        <if test="courseScoreDTO.category!=null">
            and c.category=#{courseScoreDTO.category}
        </if>
        <if test="courseScoreDTO.name!=null">
            and c.name like '%${courseScoreDTO.name}%'
        </if>
        limit #{startNum},#{pageSize}
    </select>

    <select id="getCourseTotalByCondition" parameterType="map" resultType="Double">
        SELECT count(*)
        FROM sc,course as c where stu_id = #{courseScoreDTO.id} and sc.course_id = c.id
        <if test="courseScoreDTO.startTime!=null">
            and c.start_time>#{courseScoreDTO.startTime}
        </if>
        <if test="courseScoreDTO.category!=null">
            and c.category=#{courseScoreDTO.category}
        </if>
        <if test="courseScoreDTO.name!=null">
            and c.name like '%${courseScoreDTO.name}%'
        </if>
    </select>

    <update id="setScoreByStu" parameterType="StuToCourse">
        update sc set score = #{score} where course_id = #{courseId} and stu_id  =#{stuId}
    </update>

</mapper>